package com.wallet.bo.wallets.ui.fragment;

import android.app.Activity;
import android.content.Intent;
import android.graphics.Color;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.TextView;
import android.widget.ViewFlipper;

import com.wallet.bo.wallets.R;
import com.wallet.bo.wallets.Utils.NavigationLogin;
import com.wallet.bo.wallets.Utils.SharedPreferencesUtil;
import com.wallet.bo.wallets.Utils.dedclick.AntiShake;
import com.wallet.bo.wallets.adapter.GalleryAdapter;
import com.wallet.bo.wallets.http.ApiBaseResponseCallback;
import com.wallet.bo.wallets.pojo.Config;
import com.wallet.bo.wallets.pojo.Gallery;
import com.wallet.bo.wallets.pojo.Navagation;
import com.wallet.bo.wallets.pojo.Notice;
import com.wallet.bo.wallets.pojo.NoticeAndGallery;
import com.wallet.bo.wallets.pojo.URL;
import com.wallet.bo.wallets.ui.activity.CommonClientWebActivity;
import com.wallet.bo.wallets.ui.activity.CommonWebActivity;
import com.wallet.bo.wallets.ui.activity.LoanMoneyActivity;
import com.wallet.bo.wallets.ui.activity.LogingActivity;
import com.wallet.bo.wallets.ui.activity.MyApplication;
import com.wallet.bo.wallets.ui.activity.OpenLoanActivity;
import com.wallet.bo.wallets.ui.weiget.ChooseView;
import com.wallet.bo.wallets.ui.weiget.banner.CycleViewPager;
import com.wallet.bo.wallets.ui.weiget.citypicker.citypickerview.widget.wheel.OnePicker;
import com.wallet.bo.wallets.ui.weiget.gallery.EcoGalleryAdapterView;
import com.wallet.bo.wallets.ui.weiget.gallery.WGallery;

import org.greenrobot.eventbus.EventBus;

import java.util.HashMap;
import java.util.List;

import butterknife.BindView;
import butterknife.OnClick;


/**
 * author:ggband
 * date:2017/8/8 9:05
 * email:ggband520@163.com
 * desc:首页借款
 */

public class LoanFragment extends BaseFragment {

    @BindView(R.id.vf_notice)
    ViewFlipper vfNotice;
    CycleViewPager cycleViewPager;
    @BindView(R.id.tv_money)
    TextView tvMoney;
    @BindView(R.id.cv_time)
    ChooseView cvTime;
    @BindView(R.id.wg)
    WGallery wg;

    @Override
    public void initView() {

    }

    private void initNotice(List<Notice> notices) {
        if (notices == null)
            return;
        for (int i = 0; i < notices.size(); i++) {
            View view = LayoutInflater.from(context).inflate(R.layout.notice_item, null);
            TextView textView = (TextView) view.findViewById(R.id.tv_notic);
            textView.setText(notices.get(i).getContent());
            textView.setTextColor(getResources().getColor(R.color.color_text_02));
            vfNotice.addView(view);
        }

    }

    @Override
    public void setViewUp() {

        getNoticeAndGallery();

    }


    @Override
    public int getLayoutId() {
        return R.layout.fragment_loan;
    }

    @OnClick({R.id.tv_money, R.id.bt_cheats, R.id.bt_help, R.id.bt_play, R.id.tv_enable, R.id.bt_loangl})
    public void onClick(View view) {
        if (AntiShake.check(view.getId())) {    //判断是否多次点击
            return;
        }
        switch (view.getId()) {
            case R.id.tv_money:
                OnePicker cityPicker = new OnePicker.Builder(activity).textSize(20)
                        .titleTextColor("#000000")
                        .backgroundPop(0xa0000000)
                        .province("6000")
                        .textColor(Color.parseColor("#000000"))
                        .provinceCyclic(false)
                        .dats(new String[]{"2000", "4000", "6000", "10000"})
                        .visibleItemsCount(7)
                        .build();

                cityPicker.show();
                cityPicker.setOnCityItemClickListener(new OnePicker.OnCityItemClickListener() {
                    @Override
                    public void onSelected(String... citySelected) {
                        tvMoney.setText(String.format(getResources().getString(R.string.rmb),citySelected[0]));
                    }

                    @Override
                    public void onCancel() {

                    }
                });
                // startActivityForResult(new Intent(activity, LoanMoneyActivity.class), 1);
                break;
            case R.id.bt_cheats:
                Intent intentMj = new Intent(activity, CommonClientWebActivity.class);
                intentMj.putExtra(CommonWebActivity.TITLE, "借款秘籍");
                intentMj.putExtra(CommonWebActivity.URL, URL.JKCENTER);
                startActivity(intentMj);
                break;
            case R.id.bt_help:
                Intent intentHelp = new Intent(activity, CommonClientWebActivity.class);
                intentHelp.putExtra(CommonWebActivity.TITLE, "帮助中心");
                intentHelp.putExtra(CommonWebActivity.URL, URL.HELPCENTER);
                startActivity(intentHelp);
                break;
            case R.id.bt_play:
                if (MyApplication.isOpen())
                    EventBus.getDefault().post(new Navagation(2));
                else {
                    NavigationLogin.navigation2Login(activity, new Intent(activity, OpenLoanActivity.class));
                }

                break;

            case R.id.bt_loangl:
                Intent intentGl = new Intent(activity, CommonClientWebActivity.class);
                intentGl.putExtra(CommonWebActivity.TITLE, "借款攻略");
                intentGl.putExtra(CommonWebActivity.URL, URL.JKCENTER);
                startActivity(intentGl);
                break;

        }

    }

    @Override
    public void onActivityResult(int requestCode, int resultCode, Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        if (resultCode == activity.RESULT_OK)
            tvMoney.setText(data.getStringExtra(LoanMoneyActivity.TAG));
    }


    @Override
    public void onDestroy() {
        super.onDestroy();
    }


    @Override
    public void onDestroyView() {
        super.onDestroyView();
    }


    private void getNoticeAndGallery() {
        httpLoader.noticAndGallery(new HashMap<String, String>(), new ApiBaseResponseCallback<NoticeAndGallery>() {
            @Override
            public void onSuccessful(final NoticeAndGallery noticeAndGallery) {
                initGallery(noticeAndGallery.getImgList());
                initNotice(noticeAndGallery.getScrollingMessage());
            }

            @Override
            public void onFailure(String msg) {

            }

            @Override
            public void onFinish() {

            }
        });
    }

    private void initGallery(final List<Gallery> galleries) {
        if (wg == null)
            return;
        wg.setAdapter(new GalleryAdapter(context, galleries));
        if (galleries != null && galleries.size() != 0) {
            wg.setSelection(Integer.MAX_VALUE/2+1);
            wg.setOnItemClickListener(new EcoGalleryAdapterView.OnItemClickListener() {
                @Override
                public void onItemClick(EcoGalleryAdapterView<?> parent, View view, int position, long id) {
                    Intent intent = new Intent(activity, CommonWebActivity.class);
                    intent.putExtra(CommonWebActivity.TITLE, galleries.get(position % galleries.size()).getTitle());
                    intent.putExtra(CommonWebActivity.URL, galleries.get(position % galleries.size()).getUrl());
                    startActivity(intent);
                }
            });
        }
    }


}
